import subprocess
import os

# Specify the repository URL and directory to clone it to
repo_url = 'https://github.com/Spiderinattack/Devops-AWS-Jenkins.git'
repo_dir = '/var/lib/jenkins/workspace/Trufflehog_Job/TruffleHog/TruffleHog_GIT_Repo'

#Check if Repo directory exists or not
if not os.path.exists(repo_dir):
    os.makedirs(repo_dir)
    print("TruffleHog Directory created")
    
# Clone the repository to the specified directory
subprocess.run(['git', 'clone', repo_url, repo_dir])

# Change to the repository directory
repo_path = repo_dir + '/.git'
os.chdir(repo_path)

# Use trufflehog to search for secrets in the latest commits
output = subprocess.check_output(['trufflehog', '--max_depth', '10', '--regex', '--entropy', 'false'])

# Print the output
print(output.decode('utf-8'))
